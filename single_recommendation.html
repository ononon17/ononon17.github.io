<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å•åˆ—å®éªŒ - æ¨èé¡µ(ç›´å…¥æ§æ—¶ç‰ˆ)</title>
<style>
/* --- åŸºç¡€æ ·å¼ --- */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background-color:#000;color:#333;font-family:-apple-system, Helvetica, sans-serif; overflow: hidden; height: 100vh; width: 100vw; position: fixed;}

/* å…¨å±å®¹å™¨ */
#fullscreen-page-container { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 2; background-color:#000; 
    scroll-snap-type: y mandatory; 
    overflow-y: scroll; 
    height: 100vh;
}
#fullscreen-page-container::-webkit-scrollbar { display: none; }

.fs-video-item { 
    position:relative; width:100vw; height:100vh; 
    scroll-snap-align: start; scroll-snap-stop: always; 
    display:flex; justify-content:center; align-items:center; background:#000; 
}
.fs-video-item video { width:100%; height:100%; object-fit:cover; background: #000; display: block;}

/* åŠ è½½åŠ¨ç”» */
.loading-spinner {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 50px; height: 50px;
    border: 5px solid rgba(255,255,255,0.2); 
    border-radius: 50%; border-top: 5px solid #fe2c55; 
    animation: spin 1s linear infinite; z-index: 4; display: none;
}
@keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

/* æ’­æ”¾/æš‚åœ ä¸­å¤®å›¾æ ‡ */
.play-status-icon {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 60px; height: 60px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 50%;
    color: white;
    font-size: 30px;
    display: flex; justify-content: center; align-items: center;
    z-index: 5;
    opacity: 0; 
    transition: opacity 0.2s;
    pointer-events: none; 
}
.fs-video-item.paused .play-status-icon { opacity: 1; }

/* äº¤äº’å±‚ä¸UI */
.click-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
.overlay { position:absolute; bottom:0; left:0; width:100%; padding:40px 15px; background:linear-gradient(to top, rgba(0,0,0,0.8), transparent); pointer-events:none; color:#fff; z-index: 2;}
.sidebar-fs { position:absolute; right:10px; bottom:120px; display:flex; flex-direction:column; gap:22px; pointer-events:auto; z-index: 10;}
.icon-btn-fs { width:48px; height:48px; background:rgba(255,255,255,0.15); border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:22px; backdrop-filter:blur(10px); color: #ffffff; cursor:pointer;}

.heart-btn.liked { color: #ff2442; } 
.star-btn.active { color: #007bff; } 

/* ç»“æŸæµ®çª— - é»˜è®¤éšè— (3åˆ†é’Ÿå¼ºåˆ¶å¼¹çª—è¢«å…³é—­åæ‰ä¼šæ˜¾ç¤º) */
.floating-finish-btn { 
    position: fixed; right: 20px; bottom: 30px; z-index: 999; 
    width: 55px; height: 55px; background: #25D366; color: white; border-radius: 50%; 
    display: none; 
    flex-direction: column; align-items: center; justify-content: center; 
    font-size: 12px; font-weight: bold; cursor: pointer; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
}

/* ç¡®è®¤å¼¹çª—æ ·å¼ */
#result-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; justify-content: center; align-items: center; }
.modal-content { background: #fff; padding: 30px; border-radius: 15px; width: 85%; max-width: 320px; text-align: center; }
.code-box { background: #f0f0f0; padding: 15px; margin: 15px 0; font-weight: bold; font-family: monospace; font-size: 16px; word-break: break-all; border: 2px dashed #ccc; }

.modal-btns { display: flex; gap: 10px; margin-top: 15px; }
.btn-cancel { flex: 1; padding: 10px; border: 1px solid #ccc; background: #fff; border-radius: 6px; cursor: pointer; color: #666; }
.btn-confirm { flex: 1; padding: 10px; border: none; background: #25D366; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; }

/* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
.top-nav-bar {
    position: fixed; top: 0; left: 0; width: 100%; height: 60px;
    z-index: 50; 
    display: flex; justify-content: center; align-items: center; gap: 20px;
    background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
    pointer-events: none;
}
.nav-item {
    font-size: 17px; font-weight: 600; 
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    transition: all 0.3s;
}
.nav-item.inactive { color: rgba(255, 255, 255, 0.6); font-size: 16px; font-weight: 500; }
.nav-item.active { color: #ffffff; font-size: 18px; font-weight: 800; border-bottom: 2px solid #fff; padding-bottom: 4px; }
</style>
</head>
<body>

<div class="top-nav-bar">
    <div class="nav-item inactive">å…³æ³¨</div>
    <div class="nav-item active">æ¨è</div>
</div>

<div id="fullscreen-page-container">
    <div id="fullscreen-feed"></div>
</div>

<div class="floating-finish-btn" id="float-btn" onclick="showManualFinish()">âœ”<br>ç»“æŸ</div>

<div id="result-modal">
    <div class="modal-content">
        <h3 id="modal-title" style="margin-bottom: 5px;">ç¡®è®¤ç»“æŸå®éªŒ?</h3>
        <p id="modal-desc" style="font-size:12px; color:#666;">ç‚¹å‡»ç¡®è®¤åå°†åœæ­¢è®¡æ—¶å¹¶ç”ŸæˆéªŒè¯ç </p>
        
        <div id="result-area" style="display:none;">
            <div class="code-box" id="code-display"></div>
            <button class="btn-confirm" onclick="copyCode()" style="width:100%; margin-top:10px;">å¤åˆ¶éªŒè¯ç </button>
        </div>

        <div class="modal-btns" id="action-btns">
            <button class="btn-cancel" id="btn-cancel" onclick="hideModal()">âŒ å–æ¶ˆè¿”å›</button>
            <button class="btn-confirm" id="btn-confirm" onclick="confirmFinish()">âœ… ç¡®è®¤æäº¤</button>
        </div>
    </div>
</div>

<script>
// --- 1. æ•°æ®å®šä¹‰ ---
const rawData = [
     { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%863%20%282%29.mov", desc: "å¦‚æœå¯ä»¥ï¼Œä½ æƒ³å’Œè°ä¸€èµ·æ¥å¤§ç†å¹å¹é£ï¼ŸğŸŒ¬ï¸" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%861%20%281%29.mov", desc: "è®²çœŸï¼Œçœ‹åˆ°è¿™ç‰‡äº‘ï¼Œä½ çš„å¿ƒæƒ…å˜å¥½äº†å—ï¼Ÿâ˜ï¸" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%8610%20%281%29.mov", desc: "è¿™ç§æ…¢èŠ‚å¥çš„å¤é•‡ç”Ÿæ´»ï¼Œæ˜¯ä½ å‘å¾€çš„å—ï¼ŸğŸµ" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%862%20%281%29.mov", desc: "ä½ æœ‰å¤šä¹…æ²¡æœ‰ç»™è‡ªå·±æ”¾ä¸ªå‡äº†ï¼Ÿâœˆï¸" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%864%20%281%29.mov", desc: "çŒœçŒœè¿™æ˜¯å¤§ç†çš„å“ªä¸ªè§’è½ï¼Ÿå»è¿‡çš„ä¸¾æ‰‹ğŸ™‹" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%865.MOV", desc: "è¿™ç§å¤©æ°”ï¼Œæœ€é€‚åˆå‘å‘†äº†ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿâ˜€ï¸" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%866%20%281%29.mov", desc: "å¦‚æœç”Ÿæ´»å¤ªç´¯ï¼Œå°±æ¥è¿™é‡Œèº²ä¸€èº²å§ğŸ " },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%867%20%281%29.mov", desc: "è¿™é‡Œçš„æ—¥è½æ˜¯ä¸æ˜¯å¾ˆæ²»æ„ˆï¼ŸğŸŒ„" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%868.MOV", desc: "å¬ï¼Œè¿™æ˜¯å¤§ç†çš„å£°éŸ³ï¼Œä½ å–œæ¬¢å—ï¼ŸğŸŒŠ" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%A4%A7%E7%90%869%20%281%29.mov", desc: "ç­”åº”æˆ‘ï¼Œè¿™è¾ˆå­ä¸€å®šè¦å»ä¸€æ¬¡å¤§ç†å¥½å—ï¼ŸğŸ¤" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%AE%A0%E7%89%A91%20%281%29.mov", desc: "å®ƒçš„çœ¼ç¥æœ‰æ²¡æœ‰èåŒ–ä½ çš„å¿ƒï¼Ÿå¤ªä¹–äº†ğŸ¥º" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%AE%A0%E7%89%A92%20%281%29.mov", desc: "æˆ‘å°±é—®ä¸€å¥ï¼Œè°èƒ½æ‹’ç»è¿™æ ·çš„å°ç‹—ï¼ŸğŸ¶" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%AE%A0%E7%89%A93%20%281%29.mov", desc: "ä¸Šç­ç´¯äº†ï¼Ÿçœ‹è¿™ä¸ªè§†é¢‘å›å›è¡€ğŸ”‹" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E5%AE%A0%E7%89%A94%20%281%29.mov", desc: "ä½ æ˜¯çŒ«æ´¾è¿˜æ˜¯ç‹—æ´¾ï¼Ÿè¯„è®ºåŒºå‘Šè¯‰æˆ‘ğŸ±ğŸ¶" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%89%8B%E5%B7%A51%20%281%29.mov", desc: "è¿™ç§ä¸“æ³¨çš„æ„Ÿè§‰ï¼Œä½ ç¾¡æ…•å—ï¼ŸğŸ§¶" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%89%8B%E5%B7%A52%20%281%29.mov", desc: "çŒœçŒœæœ€åæˆå“ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼ŸğŸ¤”" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%89%8B%E5%B7%A53%20%281%29.mov", desc: "å‘¨æœ«å®…å®¶åšæ‰‹å·¥ï¼Œæ˜¯ä¸æ˜¯å¾ˆè§£å‹ï¼Ÿâœ‚ï¸" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E8%A7%A3%E5%8E%8B1%20%281%29.mov", desc: "å¼ºè¿«ç—‡è¡¨ç¤ºçœ‹å®Œè¿™ä¸ªè§†é¢‘æåº¦èˆ’é€‚ï¼âœ¨" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E8%A7%A3%E5%8E%8B2%20%281%29.mov", desc: "è¿™ç§ä¸æ»‘çš„æ„Ÿè§‰ï¼Œèƒ½ä¸èƒ½æ²»å¥½ä½ çš„ç²¾ç¥å†…è€—ï¼ŸğŸ§ " },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E8%A7%A3%E5%8E%8B3%20%281%29.mov", desc: "æ·±å¤œç¡ä¸ç€ï¼Ÿçœ‹è¿™ä¸ªè§†é¢‘åŠ©çœ å§ğŸ˜´" }
];
const adData = [
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%89%8B%E8%A1%A8%20%281%29.mov", desc: "éƒ½åœ¨é—®é“¾æ¥ï¼Ÿè¿™æ¬¾è¡¨çš„è®¾è®¡æ„ŸçœŸçš„ç»äº†âœ¨", adProduct: "W" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%B6%A6%E8%82%A4%E4%B9%B3%20%281%29.mov", desc: "æ¢å­£çš®è‚¤å¹²ç‡¥ï¼Ÿè¯•è¯•è¿™ä¸ªï¼Œäº²æµ‹å¥½ç”¨ï¼ğŸ’§", adProduct: "L" },
    { url: "https://interfaceexperience.oss-cn-hangzhou.aliyuncs.com/%E6%89%8B%E6%9C%BA%20%282%29.mov", desc: "éšæ‰‹ä¸€æ‹å°±æ˜¯å¤§ç‰‡ï¼Œè¿™åƒç´ ä½ æ‰“å‡ åˆ†ï¼ŸğŸ“·", adProduct: "P" }
];

// ç»„è£…æ•°æ®
function assembleVideoData() {
    let contents = [...rawData];
    for (let i = contents.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [contents[i], contents[j]] = [contents[j], contents[i]];
    }
    let final = [];
    let cIdx = 0;
    for (let i = 0; i < 23; i++) {
        if (i === 5) final.push({...adData[0], type: "ad"}); 
        else if (i === 11) final.push({...adData[1], type: "ad"});
        else if (i === 17) final.push({...adData[2], type: "ad"});
        else if (cIdx < contents.length) final.push({...contents[cIdx++], type: "content"});
    }
    return final;
}
const videoData = assembleVideoData();

// --- 2. æ¸²æŸ“ ---
const fsFeed = document.getElementById('fullscreen-feed');
const fsContainer = document.getElementById('fullscreen-page-container');
let fsVideoElements = [];

videoData.forEach((item, idx) => {
    const f = document.createElement('div');
    f.className = 'fs-video-item';
    f.id = `video-item-${idx}`;
    if(item.type === "ad") { 
        f.dataset.isAd = "true"; 
        f.dataset.product = item.adProduct; 
    }
    
    f.innerHTML = `
        <video data-src="${item.url}" loop playsinline webkit-playsinline x5-video-player-type="h5" x5-playsinline="true" preload="auto"></video>
        
        <div class="play-status-icon">â–¶</div>
        <div class="loading-spinner"></div>
        
        <div class="click-layer"></div>
        <div class="overlay"><div style="font-weight:700;margin-bottom:5px;">@ç”¨æˆ·_${1000+idx}</div><div>${item.desc}</div></div>
        <div class="sidebar-fs">
            <div class="icon-btn-fs heart-btn">â¤</div>
            <div class="icon-btn-fs comment-btn">ğŸ’¬</div>
            <div class="icon-btn-fs star-btn">â˜…</div>
            <div class="icon-btn-fs share-btn">ğŸ”—</div>
        </div>
    `;

    const video = f.querySelector('video');
    const spinner = f.querySelector('.loading-spinner');
    
    // çŠ¶æ€ç›‘å¬
    video.addEventListener('waiting', () => { spinner.style.display = 'block'; });
    video.addEventListener('playing', () => { spinner.style.display = 'none'; });
    video.addEventListener('canplay', () => { spinner.style.display = 'none'; });
    video.addEventListener('error', () => { spinner.style.display = 'block'; });

    // ç‚¹å‡»äº¤äº’
    f.querySelector('.click-layer').onclick = () => {
        if(!video.src) return;
        if(video.paused) {
            video.play();
            f.classList.remove('paused'); 
        } else {
            video.pause();
            f.classList.add('paused'); 
        }
    };
    f.querySelector('.heart-btn').onclick = (e) => { e.stopPropagation(); e.target.classList.toggle('liked'); };
    f.querySelector('.star-btn').onclick = (e) => { e.stopPropagation(); e.target.classList.toggle('active'); };
    f.querySelector('.comment-btn').onclick = (e) => { e.stopPropagation(); alert('è¯„è®ºåŠŸèƒ½æš‚æœªå¼€æ”¾'); };
    f.querySelector('.share-btn').onclick = (e) => { e.stopPropagation(); alert('é“¾æ¥å·²å¤åˆ¶'); };

    fsFeed.appendChild(f);
    fsVideoElements.push(f);
});

// --- 3. æ’­æ”¾ä¸ç»Ÿè®¡é€»è¾‘ ---
let isExperimentStarted = false;
let currentActiveIndex = -1;
let adStats = { "W": 0, "L": 0, "P": 0 };
let currentAdProduct = null;
let currentAdStartTime = 0;

// é“¾å¼åŠ è½½
function startSequentialLoading(idx) {
    if (idx >= fsVideoElements.length) return;
    const container = fsVideoElements[idx];
    const vid = container.querySelector('video');

    if (!vid.getAttribute('src') && vid.dataset.src) {
        vid.src = vid.dataset.src;
        vid.addEventListener('loadedmetadata', () => {
            startSequentialLoading(idx + 1);
        }, { once: true });
        setTimeout(() => {
            if (idx + 1 < fsVideoElements.length && !fsVideoElements[idx+1].querySelector('video').src) {
                startSequentialLoading(idx + 1);
            }
        }, 500);
    } else {
        startSequentialLoading(idx + 1);
    }
}

function playVideo(index) {
    if (index < 0 || index >= fsVideoElements.length) return;
    const container = fsVideoElements[index];
    const vid = container.querySelector('video');
    currentActiveIndex = index;

    if (!vid.src && vid.dataset.src) vid.src = vid.dataset.src;
    
    vid.muted = false;
    container.classList.remove('paused');
    
    // è‡ªåŠ¨æ’­æ”¾
    vid.play().catch(e => {
        console.log("Auto-play blocked, waiting for interaction.");
        container.classList.add('paused');
    });
}

const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
        const container = entry.target;
        const v = container.querySelector('video');
        const index = fsVideoElements.indexOf(container);
        
        const isAd = container.dataset.isAd === "true";
        const prod = container.dataset.product;

        if(entry.isIntersecting) {
            // æ»‘å…¥ï¼šæ’­æ”¾
            if (isExperimentStarted) {
                playVideo(index);
                if (isAd) {
                    currentAdProduct = prod;
                    currentAdStartTime = Date.now();
                }
            }
        } else {
            // æ»‘å‡ºï¼šæš‚åœ
            v.pause();
            container.classList.remove('paused'); 
            if (isAd && currentAdProduct === prod) {
                const duration = Date.now() - currentAdStartTime;
                adStats[prod] += duration;
                currentAdProduct = null;
            }
        }
    });
}, { threshold: 0.6, root: fsContainer });

fsVideoElements.forEach(el => observer.observe(el));

// --- 4. å®éªŒæ§åˆ¶é€»è¾‘ (ç›´å…¥æ¨¡å¼ + 3åˆ†é’Ÿå¼ºåˆ¶) ---

// è®¾ç½®å®éªŒæ—¶é•¿ 3åˆ†é’Ÿ = 180000 æ¯«ç§’
const EXPERIMENT_DURATION = 180000; 

// é¡µé¢åŠ è½½å®Œæ¯•åç«‹å³å¯åŠ¨
window.addEventListener('DOMContentLoaded', () => {
    isExperimentStarted = true;
    
    // 1. å°è¯•æ’­æ”¾ç¬¬ä¸€ä¸ª
    playVideo(0);
    // 2. å¼€å§‹åå°ä¸‹è½½
    startSequentialLoading(0);
    // 3. å¯åŠ¨3åˆ†é’Ÿå€’è®¡æ—¶
    setTimeout(forceTimeUp, EXPERIMENT_DURATION);
});

// å¼ºåˆ¶æ—¶é—´åˆ°
function forceTimeUp() {
    // æš‚åœæ‰€æœ‰è§†é¢‘
    fsVideoElements.forEach(el => el.querySelector('video').pause());

    // ç”Ÿæˆä»£ç å¹¶æ˜¾ç¤º
    generateCode();
    
    // ä¿®æ”¹å¼¹çª—æ–‡æ¡ˆ
    document.querySelector('#result-modal h3').innerText = "æµè§ˆä½“éªŒå·²å®Œæˆ";
    document.querySelector('#result-modal p').innerText = "æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼Œè¯·å¤åˆ¶ä¸‹æ–¹ä»£ç ã€‚";
    
    // æ˜¾ç¤ºç»“æœåŒºåŸŸ
    document.getElementById('action-btns').style.display = 'none'; 
    document.getElementById('result-area').style.display = 'block';
    
    // æ˜¾ç¤ºâ€œæš‚ä¸æäº¤â€æŒ‰é’®é€»è¾‘
    const actionArea = document.getElementById('action-btns');
    actionArea.style.display = 'flex';
    document.getElementById('btn-confirm').style.display = 'none'; 
    
    const cancelBtn = document.getElementById('btn-cancel');
    cancelBtn.innerText = "æš‚ä¸æäº¤ï¼Œç»§ç»­æµè§ˆ";
    cancelBtn.onclick = function() {
        hideModal();
        // ç”¨æˆ·é€‰æ‹©ç»§ç»­æµè§ˆåï¼Œæ˜¾ç¤ºå³ä¸‹è§’çš„æµ®åŠ¨æŒ‰é’®
        document.getElementById('float-btn').style.display = 'flex';
        // æ¢å¤æ’­æ”¾
        if(currentActiveIndex !== -1) playVideo(currentActiveIndex);
    };

    showModal();
}

// æ‰‹åŠ¨ç‚¹å‡»æµ®åŠ¨æŒ‰é’®ç»“æŸ
function showManualFinish() {
    // æ¢å¤å¼¹çª—é»˜è®¤çŠ¶æ€
    document.querySelector('#result-modal h3').innerText = "ç¡®è®¤ç»“æŸå®éªŒ?";
    document.querySelector('#result-modal p').innerText = "ç‚¹å‡»ç¡®è®¤åå°†åœæ­¢è®¡æ—¶å¹¶ç”ŸæˆéªŒè¯ç ";
    document.getElementById('result-area').style.display = 'none';
    document.getElementById('action-btns').style.display = 'flex';
    document.getElementById('btn-confirm').style.display = 'block';
    document.getElementById('btn-cancel').innerText = "âŒ å–æ¶ˆè¿”å›";
    document.getElementById('btn-cancel').onclick = hideModal;

    showModal();
}

// å¼¹çª—æ§åˆ¶
const modal = document.getElementById('result-modal');
function showModal() { modal.style.display = 'flex'; }
function hideModal() { 
    modal.style.display = 'none'; 
    if(currentActiveIndex !== -1 && isExperimentStarted) playVideo(currentActiveIndex);
}

// ç”ŸæˆéªŒè¯ç 
function generateCode() {
    // ç»“ç®—æœ€åä¸€æ¬¡å¹¿å‘Šæ—¶é—´
    if (currentAdProduct) {
        const duration = Date.now() - currentAdStartTime;
        adStats[currentAdProduct] += duration;
        currentAdProduct = null; 
    }

    const timeW = (adStats.W / 1000).toFixed(1);
    const timeL = (adStats.L / 1000).toFixed(1);
    const timeP = (adStats.P / 1000).toFixed(1);
    const randomCode = Math.floor(Math.random() * 900) + 100;
    const finalCode = `W${timeW}-L${timeL}-P${timeP}-${randomCode}`;

    document.getElementById('code-display').innerText = finalCode;
}

function confirmFinish() {
    fsVideoElements.forEach(el => el.querySelector('video').pause());
    generateCode();
    
    document.getElementById('action-btns').style.display = 'none';
    document.getElementById('result-area').style.display = 'block';
    document.querySelector('#result-modal h3').innerText = "å®éªŒç»“æŸ";
    document.querySelector('#result-modal p').innerText = "è¯·å¤åˆ¶ä¸‹æ–¹ä»£ç å¡«å…¥é—®å·";
}

function copyCode() {
    navigator.clipboard.writeText(document.getElementById('code-display').innerText);
    alert("éªŒè¯ç å·²å¤åˆ¶ï¼");
}
</script>
</body>
</html>
