<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æµè§ˆé¡µé¢</title>
<style>
/* --- å…¨å±€è®¾ç½® --- */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background-color:#f6f7f9;color:#333;font-family:sans-serif; overflow: hidden; height: 100vh; width: 100vw; position: fixed;}

/* --- é¡µé¢å®¹å™¨ --- */
.page-container {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    overflow-y: auto; -webkit-overflow-scrolling: touch;
    transition: transform 0.3s ease-out;
}
#grid-page-container { z-index: 1; background-color:#f6f7f9; padding: 10px; padding-bottom: 80px; }

/* å…¨å±å®¹å™¨è®¾ç½® */
#fullscreen-page-container { 
    z-index: 2; 
    background-color:#000; 
    transform: translateX(100%); 
    scroll-snap-type: y mandatory; 
    overflow-y: scroll; 
    height: 100vh;
}
#fullscreen-page-container.active { transform: translateX(0); }
#fullscreen-page-container::-webkit-scrollbar { display: none; }

/* --- é¦–é¡µç½‘æ ¼ --- */
#grid-feed { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.grid-item { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.05); position: relative; }
.grid-video-wrapper { position: relative; width: 100%; padding-bottom: 133%; background: #000; pointer-events: none; }
.grid-video-wrapper video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
.grid-play-icon { position: absolute; top: 10px; right: 10px; color: white; font-size: 16px; }
.card-footer { padding: 10px; }
.video-desc-grid { font-size: 13px; line-height: 1.4; height: 36px; overflow: hidden; margin-bottom: 8px; font-weight: 500;}

/* --- å…¨å±æ²‰æµ¸é¡µ --- */
.fs-video-item { 
    position:relative;
    width:100vw;
    height:100vh;
    scroll-snap-align: start; 
    scroll-snap-stop: always;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#000;
}
.fs-video-item video { width:100%; height:100%; object-fit:cover; }

.overlay { position:absolute; bottom:0; left:0; width:100%; padding:40px 15px; background:linear-gradient(to top, rgba(0,0,0,0.7), transparent); pointer-events:none; color:#fff; }
.sidebar-fs { position:absolute; right:10px; bottom:120px; display:flex; flex-direction:column; gap:20px; pointer-events:auto; }
.icon-btn-fs { width:45px; height:45px; background:rgba(255,255,255,0.2); border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:20px; }

/* æ‚¬æµ®æ§åˆ¶æŒ‰é’® */
.floating-finish-btn { position: fixed; right: 20px; bottom: 30px; z-index: 999; width: 55px; height: 55px; background: #25D366; color: white; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
.back-btn-global { position: fixed; top: 40px; left: 20px; z-index: 999; width: 35px; height: 35px; background: rgba(0,0,0,0.5); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white; cursor: pointer; }

/* å¼¹çª— */
#result-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; }
.modal-content { background: #fff; padding: 30px; border-radius: 15px; width: 80%; text-align: center; }
.code-box { background: #eee; padding: 15px; margin: 15px 0; font-weight: bold; font-size: 18px; }
</style>
</head>
<body>

<div id="grid-page-container" class="page-container">
    <div id="grid-feed"></div>
</div>

<div id="fullscreen-page-container" class="page-container">
    <div id="fullscreen-feed"></div>
</div>

<div id="global-finish-btn" class="floating-finish-btn" onclick="openModal()">âœ”<br>ç»“æŸ</div>
<div id="global-back-btn" class="back-btn-global" onclick="exitFullScreen()">â®</div>

<div id="result-modal">
    <div class="modal-content">
        <h3>å®éªŒç»“æŸ</h3>
        <p>è¯·å¤åˆ¶éªŒè¯ç å¹¶è¿”å› Credamo</p>
        <div class="code-box" id="code-display"></div>
        <button onclick="copyCode()" style="padding:10px 20px; background:#25D366; color:white; border:none; border-radius:5px;">å¤åˆ¶éªŒè¯ç </button>
    </div>
</div>

<script>
const videoData = [
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%863.mov", desc: "å¤§ç†é£æ™¯ 03", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%861.mov", desc: "å¤§ç†é£æ™¯ 01", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%8610.mov", desc: "å¤§ç†é£æ™¯ 10", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E8%A1%A8.mov", desc: "å¹¿å‘Šï¼šç²¾æ¹›å·¥è‰º #æ‰‹è¡¨", type: "ad", adProduct: "W" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%B6%A6%E8%82%A4%E4%B9%B3.mov", desc: "å¹¿å‘Šï¼šæ·±å±‚æ»‹æ¶¦ #æ¶¦è‚¤ä¹³", type: "ad", adProduct: "L" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E6%9C%BA.mov", desc: "å¹¿å‘Šï¼šå½±åƒæ——èˆ° #æ‰‹æœº", type: "ad", adProduct: "P" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%AE%A0%E7%89%A91.mov", desc: "å¯çˆ±å® ç‰© 01", type: "content" }
];

const gridFeed = document.getElementById('grid-feed');
const fsFeed = document.getElementById('fullscreen-feed');
const fsContainer = document.getElementById('fullscreen-page-container');
const backBtn = document.getElementById('global-back-btn');
const finishBtn = document.getElementById('global-finish-btn');
let fsVideoElements = [];

// åˆå§‹åŒ–é¦–é¡µ (Grid)
videoData.forEach((item, idx) => {
    const d = document.createElement('div');
    d.className = 'grid-item';
    d.innerHTML = `<div class="grid-video-wrapper"><video src="${item.url}#t=0.1" muted></video><div class="grid-play-icon">â–¶</div></div><div class="card-footer"><div class="video-desc-grid">${item.desc}</div></div>`;
    d.onclick = () => enterFullScreen(idx);
    gridFeed.appendChild(d);
});

// åˆå§‹åŒ–å…¨å±é¡µ (Fullscreen)
videoData.forEach((item, idx) => {
    const d = document.createElement('div');
    d.className = 'fs-video-item';
    if(item.type === 'ad') { d.dataset.isAd = "true"; d.dataset.product = item.adProduct; }
    
    // --- ä¿®å¤ç‚¹1ï¼šç»™å…¨å±è§†é¢‘é»˜è®¤åŠ ä¸Š muted å±æ€§ï¼Œé˜²æ­¢æ„å¤–å‡ºå£° ---
    d.innerHTML = `<video src="${item.url}" loop playsinline muted></video><div class="overlay"><div class="user-name-fs">@ç”¨æˆ·_${idx}</div><div class="video-desc-fs">${item.desc}</div></div><div class="sidebar-fs"><div class="icon-btn-fs">â¤</div><div class="icon-btn-fs">ğŸ’¬</div></div>`;
    fsFeed.appendChild(d);
    fsVideoElements.push(d);
});

// --- æ ¸å¿ƒäº¤äº’ä¼˜åŒ– ---

function enterFullScreen(index) {
    fsContainer.classList.add('active');
    
    setTimeout(() => {
        fsVideoElements[index].scrollIntoView();
        const v = fsVideoElements[index].querySelector('video');
        
        // --- ä¿®å¤ç‚¹2ï¼šåªæœ‰åœ¨è¿›å…¥å…¨å±æ—¶ï¼Œæ‰è§£å¼€é™éŸ³å¹¶æ’­æ”¾ ---
        v.muted = false; // å–æ¶ˆé™éŸ³
        v.play().catch(e => console.log("æ’­æ”¾è¢«æ‹¦æˆª"));
    }, 50);

    backBtn.style.display = 'flex';
    finishBtn.style.display = 'none';
}

function exitFullScreen() {
    fsContainer.classList.remove('active');
    fsVideoElements.forEach(el => {
        const v = el.querySelector('video');
        v.pause();
        v.muted = true; // é€€å‡ºæ—¶é‡æ–°é™éŸ³
    });
    backBtn.style.display = 'none';
    finishBtn.style.display = 'flex';
}

// --- æ•°æ®ç»Ÿè®¡ä¸æ’­æ”¾æ§åˆ¶ ---
let adStats = { "W": 0, "L": 0, "P": 0 };
let currentAdEnterTime = 0;
let currentAdProduct = null;

const obs = new IntersectionObserver(entries => {
    // --- ä¿®å¤ç‚¹3ï¼šå¦‚æœå…¨å±å®¹å™¨ä¸æ´»è·ƒï¼ˆçœ‹ä¸è§ï¼‰ï¼Œç›´æ¥åœæ­¢ä»»ä½•æ“ä½œï¼Œæœç»åå°å·è·‘ ---
    if (!fsContainer.classList.contains('active')) return;

    entries.forEach(entry => {
        const v = entry.target.querySelector('video');
        const isAd = entry.target.dataset.isAd === "true";
        const prod = entry.target.dataset.product;

        if(entry.isIntersecting) {
            // æ»‘åŠ¨åˆ°äº†æ–°è§†é¢‘ï¼šå–æ¶ˆé™éŸ³å¹¶æ’­æ”¾
            v.muted = false; 
            v.play().catch(()=>{});
            
            if(isAd) { currentAdEnterTime = Date.now(); currentAdProduct = prod; }
        } else {
            // æ»‘èµ°äº†ï¼šæš‚åœå¹¶é™éŸ³
            v.pause();
            v.muted = true;
            
            if(isAd && currentAdProduct === prod) {
                adStats[prod] += (Date.now() - currentAdEnterTime);
                currentAdProduct = null;
            }
        }
    });
}, { threshold: 0.5, root: fsContainer });

fsVideoElements.forEach(el => obs.observe(el));

function openModal() {
    const code = `FIN-${adStats.W}-${adStats.L}-${adStats.P}-${Math.floor(Math.random()*1000)}`;
    document.getElementById('code-display').innerText = code;
    document.getElementById('result-modal').style.display = 'flex';
}

function copyCode() {
    navigator.clipboard.writeText(document.getElementById('code-display').innerText);
    alert("å·²å¤åˆ¶éªŒè¯ç ï¼");
}
</script>
</body>
</html>