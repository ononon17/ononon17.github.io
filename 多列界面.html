<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>æµè§ˆé¡µé¢</title>
<style>
/* --- å…¨å±€è®¾ç½® --- */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background-color:#f6f7f9;color:#333;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; height: 100vh; width: 100vw;}

/* --- é¡µé¢å®¹å™¨ --- */
.page-container {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    overflow-y: auto; -webkit-overflow-scrolling: touch;
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
#grid-page-container { z-index: 1; background-color:#f6f7f9; padding: 10px; padding-bottom: 80px; }
#fullscreen-page-container { z-index: 2; background-color:#000; transform: translateX(100%); scroll-snap-type:y mandatory; overflow-y:scroll;}
#fullscreen-page-container.active { transform: translateX(0); }

/* --- é¦–é¡µç½‘æ ¼ --- */
#grid-feed { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.grid-item { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.05); position: relative; cursor: pointer; }
.grid-video-wrapper { position: relative; width: 100%; padding-bottom: 133%; background: #000; pointer-events: none; }
.grid-video-wrapper video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
.grid-play-icon { position: absolute; top: 10px; right: 10px; color: rgba(255,255,255,0.9); font-size: 16px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
.card-footer { padding: 10px; }
.video-desc-grid { font-size: 13px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; font-weight: 500; color: #333; margin-bottom: 8px; min-height: 36px; }
.card-user-info { display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: #999; }
.user-name { display: flex; align-items: center; }
.user-avatar { width: 18px; height: 18px; background: #eee; border-radius: 50%; margin-right: 5px; }
.like-wrapper-grid { display: flex; align-items: center; }
.heart-icon-grid { font-size: 14px; margin-right: 3px; color: #999;}

/* --- å…¨å±æ²‰æµ¸é¡µ --- */
#fullscreen-page-container::-webkit-scrollbar { display: none; }
.fs-video-item { position:relative;width:100%;height:100%;scroll-snap-align:start;display:flex;justify-content:center;align-items:center;background:#000;overflow:hidden }
.fs-video-item video { width:100%;height:100%;object-fit:cover;display:block }
.overlay { position:absolute;bottom:0;left:0;width:100%;height:100%;pointer-events:none;background:linear-gradient(to top,rgba(0,0,0,0.6),transparent 35%);display:flex;flex-direction:column;justify-content:flex-end;padding:20px 15px; color:#fff; }
.video-info-fs { margin-bottom:20px;max-width:85%;text-shadow:0 1px 2px rgba(0,0,0,0.6) }
.user-name-fs { font-weight:700;font-size:16px;margin-bottom:6px; }
.video-desc-fs { font-size:14px;line-height:1.4;opacity:0.9; }
.sidebar-fs { position:absolute;right:10px;bottom:100px;display:flex;flex-direction:column;gap:20px;pointer-events:auto;align-items:center;z-index:10; color:#fff; }
.icon-btn-fs { width:40px;height:40px;background:rgba(255,255,255,0.15);border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:22px;backdrop-filter:blur(4px);cursor:pointer;transition:transform 0.2s; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
.icon-btn-fs:active { transform:scale(0.9) }
.heart-icon-fs.liked { color: #f44336; animation: heartBeat 0.4s ease-in-out; }
.play-state-icon { position:absolute;font-size:60px;opacity:0;pointer-events:none;transition:opacity 0.2s;text-shadow:0 2px 10px rgba(0,0,0,0.5);z-index:5; color:#fff; }
.fs-video-item.paused .play-state-icon { opacity:0.8; }

/* --- ğŸ”´ å…³é”®ä¿®å¤ï¼šå…¨å±€æ‚¬æµ®æŒ‰é’® (ç§»å‡º transform å®¹å™¨) --- */
/* 1. ç»“æŸæŒ‰é’® (é¦–é¡µ) */
.floating-finish-btn {
    position: fixed; right: 20px; bottom: 30px; z-index: 9999;
    width: 55px; height: 55px;
    background: #25D366; color: white; font-size: 13px; font-weight: bold;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    border-radius: 50%; cursor: pointer;
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
    transition: transform 0.1s, opacity 0.3s;
}
.floating-finish-btn:active { transform: scale(0.95); }

/* 2. è¿”å›æŒ‰é’® (å…¨å±é¡µ) - åˆå§‹éšè— */
.back-btn-global {
    position: fixed; top: 30px; left: 20px; z-index: 9999;
    width: 36px; height: 36px;
    background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50%; backdrop-filter: blur(4px);
    display: none; /* é»˜è®¤éšè— */
    justify-content: center; align-items: center; cursor: pointer;
}
.back-arrow { color: #fff; font-size: 20px; font-weight: bold; transform: translateX(-1px); }

/* --- å¼¹çª—ä¸åŠ¨ç”» --- */
#result-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; justify-content: center; align-items: center; }
.modal-content { background: #fff; color: #333; padding: 25px; border-radius: 16px; width: 85%; max-width: 320px; text-align: center; position: relative; }
.code-box { background: #f1f3f5; padding: 12px; margin: 15px 0; font-family: monospace; font-size: 18px; letter-spacing: 1px; color: #2b2b2b; border: 1px dashed #ccc; border-radius: 8px; word-break: break-all; }
.copy-btn { background: #25D366; color: white; border: none; padding: 12px 0; border-radius: 8px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 10px; }
.close-btn { background: transparent; color: #888; border: 1px solid #ddd; padding: 10px 0; border-radius: 8px; font-size: 14px; width: 100%; cursor: pointer; }
.close-icon-top { position: absolute; top: 10px; right: 15px; font-size: 24px; color: #999; cursor: pointer; }
@keyframes heartBeat { 0%{transform:scale(1)} 50%{transform:scale(1.2)} 100%{transform:scale(1)} }
</style>
</head>
<body>

<div id="grid-page-container" class="page-container">
    <div id="grid-feed"></div>
</div>

<div id="fullscreen-page-container" class="page-container">
    <div id="fullscreen-feed"></div>
</div>

<div id="global-finish-btn" class="floating-finish-btn" onclick="openModal()">âœ”<br>ç»“æŸ</div>
<div id="global-back-btn" class="back-btn-global" onclick="exitFullScreen()">
    <span class="back-arrow">â®</span>
</div>

<div id="result-modal">
    <div class="modal-content">
        <div class="close-icon-top" onclick="closeModal()">Ã—</div>
        <div class="modal-title">å®éªŒç»“æŸ</div>
        <p style="font-size:13px; color:#666; margin-bottom:10px;">è¯·å¤åˆ¶ä¸‹æ–¹éªŒè¯ç ï¼š</p>
        <div class="code-box" id="code-display">...</div>
        <button class="copy-btn" onclick="copyCode()">å¤åˆ¶éªŒè¯ç </button>
        <button class="close-btn" onclick="closeModal()">è¿”å›</button>
    </div>
</div>

<script>
const videoData = [
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%863.mov", desc: "ä½ å–œæ¬¢è¿™ä¸ªè§†é¢‘å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%861.mov", desc: "ä½ è§‰å¾—è¿™ä¸ªå†…å®¹æ€ä¹ˆæ ·ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%8610.mov", desc: "è¿™ä¸ªè§†é¢‘ç¬¦åˆä½ çš„å–œå¥½å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%862.mov", desc: "ä½ å¯¹è¿™ä¸ªè§†é¢‘æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%864.mov", desc: "è¿™ä¸ªè§†é¢‘å¸å¼•ä½ å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E8%A1%A8.mov", desc: "å¹¿å‘Šï¼šç²¾æ¹›å·¥è‰ºï¼Œæ—¶é—´ä¹‹é€‰ #æ‰‹è¡¨", type: "ad", adProduct: "W" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%865.MOV", desc: "ä½ è§‰å¾—è¿™ä¸ªè§†é¢‘æœ‰è¶£å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%866.mov", desc: "ä½ ä¼šç»™è¿™ä¸ªè§†é¢‘ç‚¹èµå—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%867.mov", desc: "çœ‹å®Œåä½ çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%868.MOV", desc: "è¿™ä¸ªè§†é¢‘è®©ä½ æ„Ÿå…´è¶£å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%A4%A7%E7%90%869.mov", desc: "ä½ è§‰å¾—è¿™ä¸ªè§†é¢‘çš„è´¨é‡å¦‚ä½•ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%B6%A6%E8%82%A4%E4%B9%B3.mov", desc: "å¹¿å‘Šï¼šæ·±å±‚æ»‹æ¶¦ï¼Œå”¤é†’è‚Œè‚¤æ°´æ¶¦ #æ¶¦è‚¤ä¹³", type: "ad", adProduct: "L" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%AE%A0%E7%89%A91.mov", desc: "ä½ æ„¿æ„æ¨èç»™æœ‹å‹å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%AE%A0%E7%89%A92.mov", desc: "è¿™ä¸ªè§†é¢‘æœ‰è§¦åŠ¨ä½ å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%AE%A0%E7%89%A93.mov", desc: "ä½ è§‰å¾—è§†é¢‘çš„å†…å®¹å®ç”¨å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E5%AE%A0%E7%89%A94.mov", desc: "è¿™ä¸ªè§†é¢‘çš„é£æ ¼ä½ å–œæ¬¢å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E5%B7%A51.mov", desc: "ä½ æƒ³çœ‹æ›´å¤šæ­¤ç±»è§†é¢‘å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E6%9C%BA.mov", desc: "å¹¿å‘Šï¼šå½±åƒæ——èˆ°ï¼Œè®°å½•ç¾å¥½ç”Ÿæ´» #æ‰‹æœº", type: "ad", adProduct: "P" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E5%B7%A52.mov", desc: "ä½ å¯¹è¿™ä¸ªè§†é¢‘çš„ç¬¬ä¸€å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E6%89%8B%E5%B7%A53.mov", desc: "è¿™ä¸ªè§†é¢‘è®©ä½ äº§ç”Ÿå…±é¸£äº†å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E8%A7%A3%E5%8E%8B1.mov", desc: "ä½ è§‰å¾—è¿™ä¸ªè§†é¢‘ç‹¬ç‰¹å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E8%A7%A3%E5%8E%8B2.mov", desc: "è§†é¢‘çš„å†…å®¹æ¸…æ™°å—ï¼Ÿ", type: "content" },
    { url: "https://gitee.com/ononon17/interface-layout/raw/master/%E8%A7%A3%E5%8E%8B3.mov", desc: "æ€»ä½“æ¥è¯´ï¼Œä½ è§‰å¾—å¦‚ä½•ï¼Ÿ", type: "content" }
];

const gridFeed = document.getElementById('grid-feed');
const fsFeed = document.getElementById('fullscreen-feed');
const fsContainer = document.getElementById('fullscreen-page-container');
const backBtn = document.getElementById('global-back-btn'); // å¼•ç”¨å…¨å±€è¿”å›æŒ‰é’®
const finishBtn = document.getElementById('global-finish-btn'); // å¼•ç”¨å…¨å±€ç»“æŸæŒ‰é’®
let fsVideoElements = []; 

// æ¸²æŸ“ç½‘æ ¼
videoData.forEach((item, idx) => {
    const d = document.createElement('div');
    d.className = 'grid-item';
    const likes = Math.floor(Math.random() * 900) + 100;
    d.innerHTML = `
        <div class="grid-video-wrapper">
            <video src="${item.url}#t=0.1" preload="metadata" playsinline webkit-playsinline muted></video>
            <div class="grid-play-icon">â–¶</div>
        </div>
        <div class="card-footer">
            <div class="video-desc-grid">${item.desc}</div>
            <div class="card-user-info">
                <div class="user-name"><div class="user-avatar"></div>ç”¨æˆ·_${1000 + idx}</div>
                <div class="like-wrapper-grid"><span class="heart-icon-grid">â¤</span>${likes}</div>
            </div>
        </div>
    `;
    d.addEventListener('click', () => enterFullScreen(idx));
    gridFeed.appendChild(d);
});

// æ¸²æŸ“å…¨å±
videoData.forEach((item, idx) => {
    const d = document.createElement('div');
    d.className = 'fs-video-item';
    if(item.type === 'ad') {
        d.setAttribute('data-is-ad', 'true');
        d.setAttribute('data-product', item.adProduct);
    }
    d.innerHTML = `
        <video src="${item.url}" loop playsinline webkit-playsinline></video>
        <div class="play-state-icon">â–¶</div>
        <div class="overlay">
            <div class="video-info-fs">
                <div class="user-name-fs">@ç”¨æˆ·_${1000 + idx}</div>
                <div class="video-desc-fs">${item.desc}</div>
            </div>
        </div>
        <div class="sidebar-fs">
            <div class="icon-btn-fs heart-icon-fs">â¤</div>
            <div class="icon-btn-fs">ğŸ’¬</div>
            <div class="icon-btn-fs share-btn-fs">ğŸ”—</div>
        </div>
    `;
    const v = d.querySelector('video');
    const heartBtn = d.querySelector('.heart-icon-fs');
    d.addEventListener('click', ev => {
        if(ev.target.closest('.sidebar-fs')) return;
        v.paused ? (v.play(), d.classList.remove('paused')) : (v.pause(), d.classList.add('paused'));
    });
    heartBtn.addEventListener('click', (e) => { e.stopPropagation(); heartBtn.classList.toggle('liked'); });
    fsFeed.appendChild(d);
    fsVideoElements.push(d);
});

// --- æ ¸å¿ƒäº¤äº’ä¼˜åŒ– ---
function enterFullScreen(index) {
    fsContainer.classList.add('active');
    fsVideoElements[index].scrollIntoView();
    const v = fsVideoElements[index].querySelector('video');
    v.currentTime = 0; v.play().catch(()=>{});
    fsVideoElements[index].classList.remove('paused');
    
    // UI åˆ‡æ¢ï¼šæ˜¾ç¤ºè¿”å›æŒ‰é’®ï¼Œéšè—ç»“æŸæŒ‰é’®
    backBtn.style.display = 'flex';
    finishBtn.style.display = 'none';
}

function exitFullScreen() {
    fsContainer.classList.remove('active');
    fsVideoElements.forEach(el => {
        const v = el.querySelector('video');
        v.pause(); el.classList.add('paused');
    });

    // UI åˆ‡æ¢ï¼šéšè—è¿”å›æŒ‰é’®ï¼Œæ˜¾ç¤ºç»“æŸæŒ‰é’®
    backBtn.style.display = 'none';
    finishBtn.style.display = 'flex';
}

// å·¦æ»‘æ‰‹åŠ¿
let touchStartX = 0;
fsContainer.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, false);
fsContainer.addEventListener('touchend', e => {
    if (e.changedTouches[0].screenX < touchStartX - 100) exitFullScreen();
}, false);

// æ•°æ®ç›‘æµ‹
let adStats = { "W": 0, "L": 0, "P": 0 }; 
let currentAdEnterTime = 0;
let currentAdProduct = null;
let isViewingAd = false;
const observer = new IntersectionObserver(entries => {
    if (!fsContainer.classList.contains('active')) return;
    entries.forEach(entry => {
        const v = entry.target.querySelector('video');
        const isAd = entry.target.getAttribute('data-is-ad') === 'true';
        const productName = entry.target.getAttribute('data-product');
        if (entry.isIntersecting) {
            v.play().catch(()=>{});
            entry.target.classList.remove('paused');
            if (isAd) {
                currentAdEnterTime = Date.now();
                currentAdProduct = productName;
                isViewingAd = true;
            }
        } else {
            v.pause();
            entry.target.classList.add('paused');
            if (isAd && isViewingAd && currentAdProduct === productName) {
                adStats[productName] += (Date.now() - currentAdEnterTime);
                isViewingAd = false;
            }
        }
    });
}, { threshold: 0.6, root: fsContainer });
fsVideoElements.forEach(el => observer.observe(el));

// å¼¹çª—é€»è¾‘
function openModal() {
    if (isViewingAd && currentAdProduct && fsContainer.classList.contains('active')) {
        adStats[currentAdProduct] += (Date.now() - currentAdEnterTime);
    }
    const code = `W${(tempStats["W"]/1000).toFixed(1)}-L${(tempStats["L"]/1000).toFixed(1)}-P${(tempStats["P"]/1000).toFixed(1)}`;
    const randomPrefix = Math.random().toString(36).substring(2, 5).toUpperCase();
    document.getElementById('code-display').innerText = `${randomPrefix}-${code}`;
    document.getElementById('result-modal').style.display = 'flex';
    exitFullScreen();
}
function closeModal() { document.getElementById('result-modal').style.display = 'none'; }
function copyCode() {
    navigator.clipboard.writeText(document.getElementById('code-display').innerText).then(() => document.querySelector('.copy-btn').innerText = "å·²å¤åˆ¶ï¼").catch(() => alert("å¤åˆ¶å¤±è´¥"));
}
</script>
</body>
</html>