<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è·¨å¹³å°å¹¿å‘Šç¾å­¦ç ”ç©¶ - å•åˆ—æµå®éªŒåˆºæ¿€ææ–™</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            width: 100%; height: 100%;
            background-color: #000;
            overflow: hidden; /* ç¦æ­¢å…¨å±€æ»šåŠ¨ï¼Œäº¤ç”±å®¹å™¨å¤„ç† */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* æ¨¡æ‹Ÿæ‰‹æœºå±å¹•å®¹å™¨ */
        #app-container {
            width: 100%;
            height: 100%;
            max-width: 480px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œæ¨¡æ‹Ÿæ‰‹æœº */
            margin: 0 auto;
            position: relative;
            background: #000;
        }

        /* è§†é¢‘æµæ»šåŠ¨å®¹å™¨ */
        .video-feed {
            width: 100%;
            height: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory; /* å¼ºåˆ¶çºµå‘å¸é™„ */
            scrollbar-width: none; /* Firefox éšè—æ»šåŠ¨æ¡ */
        }
        .video-feed::-webkit-scrollbar { display: none; /* Chrome/Safari éšè—æ»šåŠ¨æ¡ */ }

        /* å•ä¸ªè§†é¢‘å®¹å™¨ */
        .video-item {
            width: 100%;
            height: 100%;
            scroll-snap-align: start; /* æ»šåŠ¨åœæ­¢æ—¶å¯¹é½é¡¶éƒ¨ */
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* ä¿æŒæ¯”ä¾‹å¡«å……ï¼Œæ¨¡æ‹Ÿå…¨å± */
            display: block;
        }

        /* æ¨¡æ‹ŸUIå±‚ï¼ˆç‚¹èµã€è¯„è®ºç­‰ï¼Œå¢åŠ çœŸå®æ„Ÿï¼‰ */
        .overlay-ui {
            position: absolute;
            bottom: 20px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .icon {
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-size: 12px;
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading-text {
            position: absolute;
            color: #666;
            z-index: 0;
        }

        /* å¯åŠ¨é®ç½©å±‚ï¼ˆè§£å†³è‡ªåŠ¨æ’­æ”¾å£°éŸ³é—®é¢˜ï¼‰ */
        #start-mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        #start-btn {
            margin-top: 20px;
            padding: 10px 30px;
            font-size: 18px;
            background: #fe2c55; /* æŠ–éŸ³çº¢ */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="start-mask">
        <h2>å®éªŒè¯´æ˜</h2>
        <p style="margin: 10px 20px; font-size: 14px; color: #ccc;">
            è¯·åƒå¹³æ—¶åˆ·çŸ­è§†é¢‘ä¸€æ ·æµè§ˆä»¥ä¸‹å†…å®¹ã€‚<br>
            ä¸Šæ»‘æŸ¥çœ‹ä¸‹ä¸€ä¸ªè§†é¢‘ã€‚
        </p>
        <button id="start-btn">å¼€å§‹æµè§ˆ</button>
    </div>

    <div class="video-feed" id="feed">
        </div>
</div>

<script>
    // ================= é…ç½®åŒºåŸŸ =================
    // è¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºæ‚¨çœŸå®çš„è§†é¢‘é“¾æ¥ï¼ˆå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯URLï¼‰
    const videoSources = [
        "https://www.w3schools.com/html/mov_bbb.mp4",      // è§†é¢‘1
        "https://www.w3schools.com/html/movie.mp4",        // è§†é¢‘2
        "https://www.w3schools.com/html/mov_bbb.mp4",      // è§†é¢‘3
        "https://www.w3schools.com/html/movie.mp4",        // è§†é¢‘4
        "https://www.w3schools.com/html/mov_bbb.mp4"       // è§†é¢‘5
    ];
    // ===========================================

    const feedContainer = document.getElementById('feed');
    const videoElements = []; // å­˜å‚¨åˆ›å»ºçš„video DOMå¯¹è±¡

    // 1. åˆå§‹åŒ–DOMç»“æ„
    function initFeed() {
        videoSources.forEach((src, index) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'video-item';
            
            // æ¨¡æ‹ŸUI
            const uiDiv = document.createElement('div');
            uiDiv.className = 'overlay-ui';
            uiDiv.innerHTML = `<div class="icon">â¤</div><div class="icon">ğŸ’¬</div><div class="icon">â†ª</div>`;
            
            // æç¤ºæ–‡å­—
            const loadingText = document.createElement('div');
            loadingText.className = 'loading-text';
            loadingText.innerText = `Loading Video ${index + 1}...`;

            // åˆ›å»ºVideoæ ‡ç­¾
            const video = document.createElement('video');
            video.playsInline = true;
            video.loop = true;
            video.preload = "none"; // åˆå§‹ä¸åŠ è½½ï¼Œç”±JSæ§åˆ¶é¡ºåº
            video.setAttribute('data-src', src); // æš‚å­˜è·¯å¾„
            video.id = `v-${index}`;

            itemDiv.appendChild(loadingText);
            itemDiv.appendChild(video);
            itemDiv.appendChild(uiDiv);
            feedContainer.appendChild(itemDiv);

            videoElements.push(video);
        });
    }

    // 2. é¡ºåºåŠ è½½é€»è¾‘ (Sequential Loading)
    // åªæœ‰å½“å‰ä¸€ä¸ªè§†é¢‘åŠ è½½äº†å…ƒæ•°æ®(loadedmetadata)æˆ–å¯ä»¥æ’­æ”¾(canplay)æ—¶ï¼Œæ‰åŠ è½½ä¸‹ä¸€ä¸ª
    function loadVideoSequentially(index) {
        if (index >= videoElements.length) return; // åŠ è½½å®Œæ¯•

        const video = videoElements[index];
        const src = video.getAttribute('data-src');
        
        console.log(`å¼€å§‹åŠ è½½ç¬¬ ${index + 1} ä¸ªè§†é¢‘`);
        video.src = src; // èµ‹å€¼srcï¼Œå¼€å§‹åŠ è½½
        video.load();

        // ç›‘å¬ï¼šå½“å½“å‰è§†é¢‘åŠ è½½å¤Ÿä¸€ç‚¹æ•°æ®åï¼Œè§¦å‘ä¸‹ä¸€ä¸ªçš„åŠ è½½
        // ä½¿ç”¨ 'loadedmetadata' æ¯”è¾ƒå¿«ï¼Œå¦‚æœç½‘é€Ÿå¿«å¯ä»¥ç”¨ 'canplay'
        const nextLoader = () => {
            loadVideoSequentially(index + 1);
            video.removeEventListener('loadedmetadata', nextLoader);
        };
        
        video.addEventListener('loadedmetadata', nextLoader);
        
        // å®¹é”™ï¼šä¸‡ä¸€å¡ä½ï¼Œ3ç§’åå¼ºåˆ¶åŠ è½½ä¸‹ä¸€ä¸ª
        setTimeout(() => {
            video.removeEventListener('loadedmetadata', nextLoader);
            if (index + 1 < videoElements.length && !videoElements[index+1].src) {
                loadVideoSequentially(index + 1);
            }
        }, 3000);
    }

    // 3. æ»šåŠ¨ç›‘å¬ä¸è‡ªåŠ¨æ’­æ”¾é€»è¾‘ (Intersection Observer)
    function initObserver() {
        const options = {
            root: feedContainer,
            threshold: 0.6 // è§†é¢‘è¶…è¿‡60%è¿›å…¥å±å¹•å³è§†ä¸ºæ¿€æ´»
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const video = entry.target.querySelector('video');
                if (!video) return;

                if (entry.isIntersecting) {
                    // è¿›å…¥å±å¹•ï¼šæ’­æ”¾
                    // ç¡®ä¿æœ‰å£°éŸ³ï¼Œå¹¶ä¸”ä»å¤´å¼€å§‹ï¼ˆæˆ–ç»§ç»­ï¼‰
                    video.muted = false; 
                    var playPromise = video.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(_ => {
                            // æ’­æ”¾æˆåŠŸ
                        }).catch(error => {
                            console.log("æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…äº¤äº’");
                        });
                    }
                } else {
                    // ç¦»å¼€å±å¹•ï¼šæš‚åœå¹¶é‡ç½®
                    video.pause();
                    video.currentTime = 0; // æ¨¡æ‹Ÿåˆ·èµ°åé‡ç½®ï¼Œä¸‹æ¬¡å›æ¥é‡å¤´æ’­
                }
            });
        }, options);

        // è§‚å¯Ÿæ‰€æœ‰ .video-item
        document.querySelectorAll('.video-item').forEach(item => {
            observer.observe(item);
        });
    }

    // 4. å¯åŠ¨é€»è¾‘
    initFeed(); // ç”ŸæˆDOM

    const startBtn = document.getElementById('start-btn');
    const startMask = document.getElementById('start-mask');

    startBtn.addEventListener('click', () => {
        // éšè—é®ç½©
        startMask.style.display = 'none';
        
        // å…³é”®ï¼šè§¦å‘åŠ è½½é˜Ÿåˆ—
        loadVideoSequentially(0);
        
        // å¯åŠ¨æ»šåŠ¨ç›‘å¬
        initObserver();

        // å°è¯•ç›´æ¥æ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘ï¼ˆå¦‚æœåœ¨è§†å£å†…ï¼‰
        // è¿™é‡Œçš„å»¶è¿Ÿæ˜¯ä¸ºäº†ç­‰å¾…DOMæ¸²æŸ“å’ŒObserverç”Ÿæ•ˆ
        setTimeout(() => {
            if(videoElements.length > 0) {
                videoElements[0].muted = false;
                videoElements[0].play();
            }
        }, 100);
    });

</script>

</body>
</html>